<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>苏苏分辨率修改</title>
  <style>
    /* Reset和基础样式 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: #f5f7fa;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-bottom: 20px;
      text-align: center;
      color: #333;
      font-size: 2.5em;
      font-weight: bold;
    }

    .container {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 1000px;
    }

    .menu {
      display: flex;
      justify-content: space-around;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .menu button {
      padding: 12px 24px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .menu button:hover {
      background-color: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .menu button.active {
      background-color: #388E3C;
    }

    .module {
      display: none;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #fafafa;
      transition: all 0.3s;
    }

    .module.active {
      display: block;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    label {
      margin-bottom: 8px;
      color: #555;
      font-weight: 600;
      font-size: 1.1em;
    }

    input[type="file"],
    input[type="number"],
    select,
    input[type="range"],
    button {
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      width: 100%;
    }

    input[type="file"]:focus,
    input[type="number"]:focus,
    select:focus,
    input[type="range"]:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
    }

    button.execute-btn {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      border: none;
      width: fit-content;
      align-self: flex-start;
      margin-top: 10px;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: bold;
      transition: background-color 0.3s, transform 0.2s;
    }

    button.execute-btn:hover {
      background-color: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .download-btn {
      background-color: #2196F3;
      color: white;
      cursor: pointer;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      margin-top: 10px;
      transition: background-color 0.3s, transform 0.2s;
      font-weight: bold;
    }

    .download-btn:hover {
      background-color: #0b7dda;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }

    .preview img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }

    .preview-details {
      text-align: center;
      color: #666;
      font-size: 0.95em;
    }

    /* 压缩质量滑块样式 */
    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider-container input[type="range"] {
      flex: 1;
    }

    .slider-percentage {
      width: 50px;
      text-align: center;
      font-weight: bold;
      color: #333;
    }

    /* 圆形裁剪预览框 */
    .crop-area {
      position: relative;
      display: inline-block;
    }

    .crop-overlay {
      position: absolute;
      border: 2px dashed #4CAF50;
      border-radius: 50%;
      cursor: move;
      transform: translate(-50%, -50%);
    }

    @media (max-width: 600px) {
      .menu {
        flex-direction: column;
      }

      .menu button {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <h1>苏苏分辨率修改</h1>
  <div class="container">
    <!-- 功能菜单 -->
    <div class="menu">
      <button data-module="uploadModule" class="active">上传图片</button>
      <button data-module="resizeModule">调整大小</button>
      <button data-module="rotateModule">旋转图片</button>
      <button data-module="compressionModule">压缩质量</button>
      <button data-module="cropModule">裁剪图片</button>
    </div>

    <!-- 上传模块 -->
    <div class="module active" id="uploadModule">
      <h2>上传图片</h2>
      <div class="input-group">
        <input type="file" id="imageUpload" accept="image/*">
      </div>
      <div class="preview" id="originalPreview" style="display: none;">
        <img id="originalImage" src="#" alt="原始图片">
        <div class="preview-details">原始图片预览</div>
      </div>
    </div>

    <!-- 调整大小模块 -->
    <div class="module" id="resizeModule">
      <h2>调整大小</h2>
      <div class="input-group">
        <label for="resizeWidth">宽度 (px)</label>
        <input type="number" id="resizeWidth" placeholder="例如: 128">
      </div>
      <div class="input-group">
        <label for="resizeHeight">高度 (px)</label>
        <input type="number" id="resizeHeight" placeholder="例如: 128">
      </div>
      <button class="execute-btn" id="resizeButton">调整大小</button>
      <div class="preview" id="resizedPreview" style="display: none;">
        <img id="resizedImage" src="#" alt="调整后的图片">
        <div class="preview-details">调整后的图片预览</div>
        <button class="download-btn" id="downloadResized">下载调整后的图片</button>
      </div>
    </div>

    <!-- 旋转模块 -->
    <div class="module" id="rotateModule">
      <h2>旋转图片</h2>
      <button class="execute-btn" id="rotateButton">旋转 90°</button>
      <div class="preview" id="rotatedPreview" style="display: none;">
        <img id="rotatedImage" src="#" alt="旋转后的图片">
        <div class="preview-details">旋转后的图片预览</div>
        <button class="download-btn" id="downloadRotated">下载旋转后的图片</button>
      </div>
    </div>

    <!-- 压缩模块 -->
    <div class="module" id="compressionModule">
      <h2>压缩质量</h2>
      <div class="input-group">
        <label for="compressionRange">压缩质量 (%)</label>
        <div class="slider-container">
          <input type="range" id="compressionRange" min="10" max="100" value="80">
          <span class="slider-percentage" id="compressionPercentage">80%</span>
        </div>
      </div>
      <div class="preview" id="compressedPreview" style="display: none;">
        <img id="compressedImage" src="#" alt="压缩后的图片">
        <div class="preview-details">压缩后的图片预览</div>
        <button class="download-btn" id="downloadCompressed">下载压缩后的图片</button>
      </div>
    </div>

    <!-- 裁剪模块 -->
    <div class="module" id="cropModule">
      <h2>裁剪图片</h2>
      <div class="input-group">
        <label for="cropSelect">选择裁剪方式</label>
        <select id="cropSelect">
          <option value="none">无裁剪</option>
          <option value="rounded">圆角矩形</option>
          <option value="circle">圆形</option>
        </select>
      </div>
      <button class="execute-btn" id="cropButton">裁剪图片</button>
      <div class="preview" id="croppedPreview" style="display: none;">
        <img id="croppedImage" src="#" alt="裁剪后的图片">
        <div class="preview-details">裁剪后的图片预览</div>
        <button class="download-btn" id="downloadCropped">下载裁剪后的图片</button>
      </div>
      <!-- 圆形裁剪区域选择 -->
      <div id="cropAreaContainer" style="display: none; position: relative; margin-top: 20px;">
        <img id="cropSourceImage" src="#" alt="裁剪源图片" style="max-width: 100%; border-radius: 8px;">
        <div class="crop-area" id="cropOverlay" style="display: none;">
          <div class="crop-overlay" id="circleOverlay"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 隐藏的Canvas用于图像处理 -->
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
    // 获取所有功能按钮
    const menuButtons = document.querySelectorAll('.menu button');

    // 获取所有模块
    const modules = document.querySelectorAll('.module');

    // 当前原始图片数据
    let originalImageData = null;

    // 获取原始图片元素
    const originalImage = document.getElementById('originalImage');
    const originalPreview = document.getElementById('originalPreview');

    // 获取Canvas和上下文
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // 上传模块元素
    const imageUpload = document.getElementById('imageUpload');

    // 调整大小模块元素
    const resizeWidth = document.getElementById('resizeWidth');
    const resizeHeight = document.getElementById('resizeHeight');
    const resizeButton = document.getElementById('resizeButton');
    const resizedImage = document.getElementById('resizedImage');
    const resizedPreview = document.getElementById('resizedPreview');
    const downloadResized = document.getElementById('downloadResized');

    // 旋转模块元素
    const rotateButton = document.getElementById('rotateButton');
    const rotatedImage = document.getElementById('rotatedImage');
    const rotatedPreview = document.getElementById('rotatedPreview');
    const downloadRotated = document.getElementById('downloadRotated');

    // 压缩模块元素
    const compressionRange = document.getElementById('compressionRange');
    const compressionPercentage = document.getElementById('compressionPercentage');
    const compressedImage = document.getElementById('compressedImage');
    const compressedPreview = document.getElementById('compressedPreview');
    const downloadCompressed = document.getElementById('downloadCompressed');

    // 裁剪模块元素
    const cropSelect = document.getElementById('cropSelect');
    const cropButton = document.getElementById('cropButton');
    const croppedImage = document.getElementById('croppedImage');
    const croppedPreview = document.getElementById('croppedPreview');
    const downloadCropped = document.getElementById('downloadCropped');
    const cropAreaContainer = document.getElementById('cropAreaContainer');
    const cropSourceImage = document.getElementById('cropSourceImage');
    const cropOverlay = document.getElementById('bulkOverlay');

    // 功能菜单点击事件
    menuButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetModule = button.getAttribute('data-module');
        // 移除所有按钮的active状态
        menuButtons.forEach(btn => btn.classList.remove('active'));
        // 添加当前按钮的active状态
        button.classList.add('active');
        // 隐藏所有模块
        modules.forEach(mod => mod.classList.remove('active'));
        // 显示选中的模块
        document.getElementById(targetModule).classList.add('active');
        // 如果切换到裁剪模块且裁剪方式为圆形，显示裁剪区域选择
        if(targetModule === 'cropModule') {
          const cropMode = cropSelect.value;
          if(cropMode === 'circle') {
            cropAreaContainer.style.display = 'block';
          } else {
            cropAreaContainer.style.display = 'none';
          }
        } else {
          cropAreaContainer.style.display = 'none';
        }
      });
    });

    // 上传图片
    imageUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        originalImage.src = event.target.result;
        originalImage.onload = function() {
          originalPreview.style.display = 'flex';
          originalImageData = event.target.result;

          // 初始化功能模块的输入值
          // 调整大小
          resizeWidth.value = originalImage.width;
          resizeHeight.value = originalImage.height;

          // 压缩质量
          compressionRange.value = 80;
          compressionPercentage.textContent = '80%';

          // 显示裁剪源图片
          cropSourceImage.src = originalImageData;

          // 清除所有预览
          clearAllPreviews();
        }
      }
      reader.readAsDataURL(file);
    });

    // 调整大小功能
    resizeButton.addEventListener('click', () => {
      if (!originalImageData) {
        alert('请先上传一张图片。');
        return;
      }

      let newWidth = parseInt(resizeWidth.value);
      let newHeight = parseInt(resizeHeight.value);

      if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) {
        alert('请输入有效的宽度和高度。');
        return;
      }

      const tempImage = new Image();
      tempImage.src = originalImageData;
      tempImage.onload = function() {
        canvas.width = newWidth;
        canvas.height = newHeight;

        // 清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 绘制调整大小后的图片
        ctx.drawImage(tempImage, 0, 0, newWidth, newHeight);

        // 获取调整后的图片URL
        const resizedDataURL = canvas.toDataURL('image/png');
        resizedImage.src = resizedDataURL;
        resizedPreview.style.display = 'flex';
      }
    });

    // 下载调整后的图片
    downloadResized.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = resizedImage.src;
      link.download = 'resized-image.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // 旋转功能
    rotateButton.addEventListener('click', () => {
      if (!originalImageData) {
        alert('请先上传一张图片。');
        return;
      }

      const tempImage = new Image();
      tempImage.src = originalImageData;
      tempImage.onload = function() {
        const rotation = 90; // 每次旋转90度
        const radians = rotation * Math.PI / 180;

        // 设置Canvas尺寸
        canvas.width = tempImage.height;
        canvas.height = tempImage.width;

        // 清空画布并进行旋转
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(radians);
        ctx.drawImage(tempImage, -tempImage.width / 2, -tempImage.height / 2);
        ctx.restore();

        // 获取旋转后的图片URL
        const rotatedDataURL = canvas.toDataURL('image/png');
        rotatedImage.src = rotatedDataURL;
        rotatedPreview.style.display = 'flex';
      }
    });

    // 下载旋转后的图片
    downloadRotated.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = rotatedImage.src;
      link.download = 'rotated-image.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // 压缩功能
    compressionRange.addEventListener('input', () => {
      if (!originalImageData) return;

      const quality = compressionRange.value / 100;
      compressionPercentage.textContent = `${compressionRange.value}%`;

      const tempImage = new Image();
      tempImage.src = originalImageData;
      tempImage.onload = function() {
        canvas.width = tempImage.width;
        canvas.height = tempImage.height;

        // 清空画布并绘制图片
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(tempImage, 0, 0);

        // 获取压缩后的图片URL
        const compressedDataURL = canvas.toDataURL('image/jpeg', quality);
        compressedImage.src = compressedDataURL;
        compressedPreview.style.display = 'flex';
      }
    });

    // 下载压缩后的图片
    downloadCompressed.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = compressedImage.src;
      link.download = 'compressed-image.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // 裁剪功能
    cropButton.addEventListener('click', () => {
      if (!originalImageData) {
        alert('请先上传一张图片。');
        return;
      }

      const cropMode = cropSelect.value;

      if (cropMode === 'none') {
        alert('请选择一种裁剪方式。');
        return;
      }

      const tempImage = new Image();
      tempImage.src = originalImageData;
      tempImage.onload = function() {
        canvas.width = tempImage.width;
        canvas.height = tempImage.height;

        // 绘制原始图片
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(tempImage, 0, 0);

        if (cropMode === 'rounded') {
          const radius = Math.min(canvas.width, canvas.height) / 10; // 圆角半径
          ctx.globalCompositeOperation = 'destination-in';
          roundedRect(ctx, 0, 0, canvas.width, canvas.height, radius);
          ctx.fill();
        } else if (cropMode === 'circle') {
          // 由用户手动选择裁剪区域
          alert('请在裁剪模块中手动选择圆形裁剪区域。');
          return;
        }

        // 恢复默认绘图模式
        ctx.globalCompositeOperation = 'source-over';

        // 获取裁剪后的图片URL
        const croppedDataURL = canvas.toDataURL('image/png');
        croppedImage.src = croppedDataURL;
        croppedPreview.style.display = 'flex';
      }
    });

    // 下载裁剪后的图片
    downloadCropped.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = croppedImage.src;
      link.download = 'cropped-image.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // 辅助函数：绘制圆角矩形路径
    function roundedRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }

    // 辅助函数：清除所有预览
    function clearAllPreviews() {
      // 调整大小预览
      resizedImage.src = '';
      resizedPreview.style.display = 'none';

      // 旋转预览
      rotatedImage.src = '';
      rotatedPreview.style.display = 'none';

      // 压缩预览
      compressedImage.src = '';
      compressedPreview.style.display = 'none';

      // 裁剪预览
      croppedImage.src = '';
      croppedPreview.style.display = 'none';
    }

    // 裁剪模块增强：圆形裁剪手动拖动选择
    // 仅在选择圆形裁剪时启用
    cropSelect.addEventListener('change', () => {
      const cropMode = cropSelect.value;
      if(cropMode === 'circle') {
        cropAreaContainer.style.display = 'block';
        setupCropArea();
      } else {
        cropAreaContainer.style.display = 'none';
      }
    });

    function setupCropArea() {
      cropOverlay.style.display = 'block';
      const img = cropSourceImage;
      const container = cropAreaContainer;

      // 初始化裁剪框参数
      const cropSize = Math.min(img.width, img.height) / 3;
      let cropX = img.width / 2;
      let cropY = img.height / 2;
      let currentSize = cropSize;

      // 设置初始裁剪框样式
      const overlay = document.getElementById('circleOverlay');
      overlay.style.width = `${currentSize}px`;
      overlay.style.height = `${currentSize}px`;
      overlay.style.left = `${cropX}px`;
      overlay.style.top = `${cropY}px`;

      // 使裁剪框可以拖动
      let isDragging = false;
      let offsetX, offsetY;

      overlay.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - overlay.offsetLeft;
        offsetY = e.clientY - overlay.offsetTop;
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          let newX = e.clientX - container.getBoundingClientRect().left - offsetX;
          let newY = e.clientY - container.getBoundingClientRect().top - offsetY;

          // 限制裁剪框在图片范围内
          newX = Math.max(currentSize / 2, Math.min(img.width - currentSize / 2, newX));
          newY = Math.max(currentSize / 2, Math.min(img.height - currentSize / 2, newY));

          overlay.style.left = `${newX}px`;
          overlay.style.top = `${newY}px`;
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });

      // 裁剪图片
      cropButton.addEventListener('click', () => {
        const cropMode = cropSelect.value;
        if(cropMode === 'circle') {
          // 获取裁剪框位置和大小
          const rect = overlay.getBoundingClientRect();
          const containerRect = container.getBoundingClientRect();

          const centerX = rect.left - containerRect.left + rect.width / 2;
          const centerY = rect.top - containerRect.top + rect.height / 2;
          const radius = rect.width / 2;

          // 绘制圆形裁剪
          canvas.width = radius * 2;
          canvas.height = radius * 2;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.save();
          ctx.beginPath();
          ctx.arc(radius, radius, radius, 0, Math.PI * 2, true);
          ctx.closePath();
          ctx.clip();

          // 绘制裁剪区域
          ctx.drawImage(
            cropSourceImage,
            centerX - radius,
            centerY - radius,
            radius * 2,
            radius * 2,
            0,
            0,
            radius * 2,
            radius * 2
          );

          ctx.restore();

          // 获取裁剪后的图片URL
          const croppedDataURL = canvas.toDataURL('image/png');
          croppedImage.src = croppedDataURL;
          croppedPreview.style.display = 'flex';
        } else if(cropMode === 'rounded') {
          // 已在按钮点击事件中处理
        }
      });
    }

  </script>
</body>
</html>
